---
import Layout from '../../layouts/Layout.astro';
import { getEntry, render } from 'astro:content';
import { type CollectionEntry } from 'astro:content';
import { breadcrumbListJsonLd } from '../../lib/seo/structuredData';

const contactEntry: CollectionEntry<'pagesEn'> | undefined = await getEntry('pagesEn', 'en/contact');

if (!contactEntry) {
  return new Response('Contact page content not found', { status: 404 });
}

const { data } = contactEntry;
const { Content } = await render(contactEntry);

// Check if form was submitted successfully
const isSuccess = Astro.url.searchParams.get('success') === 'true';

const site = Astro.site ?? new URL('https://devisia.pro');
const breadcrumbs = breadcrumbListJsonLd({
  site,
  items: [
    { name: 'Home', url: '/en/' },
    { name: data.title, url: '/en/contact' },
  ],
});
---

<Layout title={data.title} description={data.description} lang="en" structuredData={[breadcrumbs]}>
  <article class="page-content">
    <Content />

    <section class="page-intro" aria-label="Contact introduction">
      <div class="intro-card">
        <h2 class="intro-title">Let’s discuss your project</h2>
        <p class="intro-text">
          Whether you’re launching a new digital product, improving an existing platform, or exploring how to introduce AI
          responsibly, this form is the fastest way to reach us. We use it to collect just enough information to respond with
          a helpful first answer—no endless back-and-forth. If you already have a clear vision, share it; if you only have a
          pain point (“we’re losing time on X”, “we can’t scale Y”), that’s totally fine. We can help you translate a problem
          into requirements, priorities, and a realistic execution plan.
        </p>
        <p class="intro-text">
          We typically reply within 1–2 business days. If your request is complex, we may suggest a short 15–30 minute call to
          align on context and outcomes. Our approach is outcome-driven: define value, reduce risk, and deliver iteratively.
          In many engagements we start with a lightweight discovery phase (stakeholder input, constraints, data/process mapping),
          then move into implementation in small increments with rapid feedback.
        </p>

        <div class="intro-grid" role="list">
          <div class="intro-item" role="listitem">
            <h3 class="intro-item-title">What to include in your message</h3>
            <ul class="intro-list">
              <li><strong>Goal</strong>: what you want to achieve and how you’ll measure success.</li>
              <li><strong>Context</strong>: industry, users, volumes, existing systems and integrations.</li>
              <li><strong>Constraints</strong>: timelines, rough budget, compliance needs (e.g. GDPR), tech stack.</li>
              <li><strong>Current state</strong>: what works today and what’s blocking progress.</li>
            </ul>
          </div>
          <div class="intro-item" role="listitem">
            <h3 class="intro-item-title">What happens after you submit</h3>
            <p class="intro-item-text">
              You’ll receive a confirmation email. Internally we review the request, prepare a few focused questions, and—if it
              makes sense—suggest next steps (e.g. quick audit, prototype, initial backlog, delivery roadmap). If you prefer, you
              can also mention time windows and your preferred channel for follow-up.
            </p>
          </div>
          <div class="intro-item" role="listitem">
            <h3 class="intro-item-title">AI, data and privacy</h3>
            <p class="intro-item-text">
              If your use case involves AI, you don’t need to share sensitive data in the form. We can start from synthetic examples
              and define a safe path: minimization, PII redaction, retention, audit logging, and policy checks. You can also begin with
              our checklist: <a class="intro-link" href="/en/tools/ai-risk-checklist">AI Risk &amp; Privacy Checklist</a>.
            </p>
          </div>
          <div class="intro-item" role="listitem">
            <h3 class="intro-item-title">Quick FAQ</h3>
            <p class="intro-item-text">
              <strong>Do you only do development?</strong> No—discovery, audits, workshops, and technical guidance are also available.
            </p>
            <p class="intro-item-text">
              <strong>Do I need a perfect brief?</strong> Not at all. We can build it together, starting from the problem.
            </p>
          </div>
        </div>

        <p class="intro-text intro-note">
          Note: the information you send is used only to manage your request and reply. For details on data processing and cookies,
          see our <a class="intro-link" href="/en/privacy">Privacy &amp; Cookie Policy</a>.
        </p>
      </div>
    </section>

    <!-- Success Message -->
    {isSuccess && (
      <div class="success-message" role="alert">
        <svg class="success-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        <div class="success-content">
          <h3 class="success-title">Message sent successfully!</h3>
          <p class="success-text">Thank you for contacting us. We've sent you a confirmation email and will get back to you as soon as possible.</p>
        </div>
      </div>
    )}

    <!-- Netlify Forms Contact Form -->
    <section class="contact-form-section">
      <form
        name="contact"
        method="POST"
        data-netlify="true"
        netlify-honeypot="bot-field"
        action="/.netlify/functions/contact-email"
        class="contact-form"
      >
        <input type="hidden" name="form-name" value="contact" />

        <p class="hidden">
          <label>
            Don't fill this out if you're human:
            <input name="bot-field" />
          </label>
        </p>

        <!-- Language field for i18n email templates -->
        <input type="hidden" name="lang" value="en" />

        <div class="form-group">
          <label for="name" class="form-label">Name *</label>
          <input
            type="text"
            id="name"
            name="name"
            required
            class="form-input"
            placeholder="Your name"
          />
        </div>

        <div class="form-group">
          <label for="email" class="form-label">Email *</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            class="form-input"
            placeholder="your.email@example.com"
          />
        </div>

        <div class="form-group">
          <label for="subject" class="form-label">Subject</label>
          <input
            type="text"
            id="subject"
            name="subject"
            class="form-input"
            placeholder="What is this about?"
          />
        </div>

        <div class="form-group">
          <label for="message" class="form-label">Message *</label>
          <textarea
            id="message"
            name="message"
            required
            rows="6"
            class="form-input"
            placeholder="Tell us more about your project or inquiry..."
          ></textarea>
        </div>

        <!-- Privacy consent -->
        <div class="form-group form-group--consent">
          <label class="consent-label" for="privacy_consent">
            <input
              id="privacy_consent"
              name="privacy_consent"
              type="checkbox"
              value="true"
              required
              class="consent-checkbox"
            />
            <span class="consent-text">
              I confirm that I have read the
              <a class="consent-link" href="/en/privacy">Privacy &amp; Cookie Policy</a>
              and I consent to the processing of my data to be contacted back.
            </span>
          </label>
        </div>

        <button type="submit" class="form-submit">Send Message</button>
      </form>
    </section>
  </article>
</Layout>

<style>
  .page-content {
    max-width: 800px;
    margin: 0 auto;
  }

  .page-intro {
    margin-top: 2.5rem;
  }

  .intro-card {
    background: var(--ds-color-surface);
    border: var(--ds-border-1) solid var(--ds-color-border);
    border-radius: var(--ds-radius-3);
    padding: var(--ds-space-6);
  }

  .intro-title {
    margin: 0 0 var(--ds-space-3);
    color: var(--ds-color-text);
    font-size: var(--ds-text-xl);
    font-weight: 700;
  }

  .intro-text {
    margin: 0 0 var(--ds-space-3);
    color: var(--ds-color-text);
    line-height: var(--ds-leading-relaxed);
  }

  .intro-note {
    margin-top: var(--ds-space-4);
    color: var(--ds-color-text-muted);
  }

  .intro-link {
    color: var(--ds-color-accent);
    text-decoration: underline;
    text-underline-offset: 3px;
  }

  .intro-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--ds-space-5);
    margin: var(--ds-space-5) 0 var(--ds-space-4);
  }

  .intro-item {
    background: var(--ds-color-surface-2);
    border: var(--ds-border-1) solid var(--ds-color-border);
    border-radius: var(--ds-radius-2);
    padding: var(--ds-space-4);
  }

  .intro-item-title {
    margin: 0 0 var(--ds-space-2);
    color: var(--ds-color-text);
    font-size: var(--ds-text-md);
    font-weight: 700;
  }

  .intro-item-text {
    margin: 0 0 var(--ds-space-2);
    color: var(--ds-color-text-muted);
    line-height: var(--ds-leading-relaxed);
  }

  .intro-list {
    margin: 0;
    padding-left: 1.15rem;
    color: var(--ds-color-text-muted);
    line-height: var(--ds-leading-relaxed);
  }

  .intro-list li + li {
    margin-top: 0.35rem;
  }

  @media (max-width: 768px) {
    .intro-card {
      padding: var(--ds-space-5);
    }

    .intro-grid {
      grid-template-columns: 1fr;
    }
  }

  .success-message {
    margin-top: 3rem;
    padding: var(--ds-space-4);
    background-color: color-mix(in srgb, var(--ds-color-success) 10%, var(--ds-color-surface));
    border: var(--ds-border-1) solid color-mix(in srgb, var(--ds-color-success) 30%, var(--ds-color-border));
    border-radius: var(--ds-radius-3);
    display: flex;
    gap: var(--ds-space-4);
    align-items: flex-start;
  }

  .success-icon {
    color: var(--ds-color-success);
    flex-shrink: 0;
    margin-top: 0.125rem;
  }

  .success-content {
    flex: 1;
  }

  .success-title {
    margin: 0 0 var(--ds-space-2);
    color: var(--ds-color-text);
    font-size: var(--ds-text-lg);
    font-weight: 600;
  }

  .success-text {
    margin: 0;
    color: var(--ds-color-text-muted);
    font-size: var(--ds-text-sm);
    line-height: var(--ds-leading-relaxed);
  }

  .contact-form-section {
    margin-top: 3rem;
    padding: var(--ds-space-6);
    background-color: var(--ds-color-surface);
    border: var(--ds-border-1) solid var(--ds-color-border);
    border-radius: var(--ds-radius-3);
  }

  .contact-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .hidden {
    display: none;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .form-group--consent {
    gap: 0;
  }

  .consent-label {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    color: var(--ds-color-text);
    font-size: var(--ds-text-sm);
    line-height: var(--ds-leading-relaxed);
    cursor: pointer;
    user-select: none;
  }

  .consent-checkbox {
    width: 18px;
    height: 18px;
    margin-top: 0.15rem;
    accent-color: var(--ds-color-accent);
    flex: 0 0 auto;
  }

  .consent-text {
    color: var(--ds-color-text-muted);
  }

  .consent-link {
    color: var(--ds-color-accent);
    text-decoration: underline;
    text-underline-offset: 3px;
  }

  .form-label {
    font-weight: 500;
    color: var(--ds-color-text);
    font-size: var(--ds-text-sm);
  }

  .form-input {
    padding: 0.75rem 1rem;
    border: var(--ds-border-1) solid var(--ds-color-border);
    border-radius: var(--ds-radius-2);
    font-size: var(--ds-text-md);
    font-family: inherit;
    transition: border-color 0.2s, box-shadow 0.2s;
    background-color: var(--ds-color-surface-2);
    color: var(--ds-color-text);
  }

  .form-input::placeholder {
    color: var(--ds-color-text-muted);
    opacity: 1;
  }

  .form-input:focus {
    outline: none;
    border-color: color-mix(in srgb, var(--ds-color-accent) 40%, var(--ds-color-border));
    box-shadow: var(--ds-focus-ring);
  }

  textarea.form-input {
    resize: vertical;
    min-height: 120px;
  }

  .form-submit {
    padding: 0.875rem 2rem;
    background-color: var(--ds-color-accent);
    color: white;
    border: none;
    border-radius: var(--ds-radius-2);
    font-size: var(--ds-text-md);
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.2s, transform 0.1s;
    align-self: flex-start;
  }

  .form-submit:focus-visible {
    outline: none;
    box-shadow: var(--ds-focus-ring);
  }

  .form-submit:hover {
    background-color: color-mix(in srgb, var(--ds-color-accent) 85%, black);
  }

  .form-submit:active {
    transform: translateY(1px);
  }

  @media (max-width: 768px) {
    .contact-form-section {
      padding: 1.5rem;
    }

    .form-submit {
      width: 100%;
    }
  }
</style>

