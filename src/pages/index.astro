---
import Layout from '../layouts/Layout.astro';
import { getEntry, render } from 'astro:content';
import { type CollectionEntry } from 'astro:content';
import HomeHero from '../components/HomeHero.astro';
import HomeWhatWeDo from '../components/HomeWhatWeDo.astro';
import HomeAICapabilities from '../components/HomeAICapabilities.astro';
import HomeAIStructureCTA from '../components/HomeAIStructureCTA.astro';
import HomeAIChecklistCTA from '../components/HomeAIChecklistCTA.astro';
import HomeHowWeWork from '../components/HomeHowWeWork.astro';
import HomeProjectsTeaser from '../components/HomeProjectsTeaser.astro';
import HomeToolsTeaser from '../components/HomeToolsTeaser.astro';
import HomeContactCTA from '../components/HomeContactCTA.astro';
import { breadcrumbListJsonLd } from '../lib/seo/structuredData';

const homeEntry: CollectionEntry<'pagesIt'> | undefined = await getEntry('pagesIt', 'it/home');

if (!homeEntry) {
  return new Response('Home page content not found', { status: 404 });
}

const { data } = homeEntry;
const { Content } = await render(homeEntry);

const site = Astro.site ?? new URL('https://devisia.pro');
const breadcrumbs = breadcrumbListJsonLd({
  site,
  items: [{ name: 'Home', url: '/' }],
});
---

<Layout title={data.title} description={data.description} heroImage={data.heroImage} structuredData={[breadcrumbs]}>
  <HomeHero
    lang="it"
    heroTitle={data.heroTitle ?? 'Sviluppiamo visione intelligente'}
    heroSubtitle={data.heroSubtitle ?? 'Devisia sviluppa prodotti SaaS e soluzioni software su misura.'}
    heroImage={data.heroImage}
  >
    <Content />
  </HomeHero>

  <div class="ds-stack" data-gap="lg" style="container-type: inline-size; margin-top: var(--ds-space-8)">
    <HomeWhatWeDo
      lang="it"
      title={data.homeWhatWeDoTitle}
      description={data.homeWhatWeDoDescription}
      cards={data.homeWhatWeDoCards ?? undefined}
    />

    <HomeAICapabilities
      lang="it"
      title={data.homeAICapabilitiesTitle}
      description={data.homeAICapabilitiesDescription}
      items={data.homeAICapabilitiesItems ?? undefined}
      ctaLabel={data.homeAICapabilitiesCtaLabel ?? undefined}
      ctaHref={data.homeAICapabilitiesCtaHref ?? undefined}
    />

    <!-- AI Structure fits best right after AI capabilities: a concrete demo before the risk checklist CTA. -->
    <HomeAIStructureCTA
      lang="it"
      title={data.homeAIStructureTitle}
      description={data.homeAIStructureDescription}
      items={data.homeAIStructureItems ?? undefined}
      ctaLabel={data.homeAIStructureCtaLabel ?? undefined}
      ctaHref={data.homeAIStructureCtaHref ?? undefined}
    />

    <HomeAIChecklistCTA
      lang="it"
      title={data.homeAIChecklistTitle}
      description={data.homeAIChecklistDescription}
    />

    <HomeHowWeWork
      lang="it"
      title={data.homeHowWeWorkTitle}
      description={data.homeHowWeWorkDescription}
      items={data.homeHowWeWorkItems ?? undefined}
    />

    <HomeProjectsTeaser
      lang="it"
      title={data.homeProjectsTitle}
      description={data.homeProjectsDescription}
      image={data.homeProjectsImage ?? undefined}
    />

    <HomeToolsTeaser lang="it" />

    <HomeContactCTA
      lang="it"
      title={data.homeContactTitle}
      description={data.homeContactDescription}
    />
  </div>
</Layout>
